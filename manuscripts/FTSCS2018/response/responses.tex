\documentclass{response}

\papertitle{Refinement of Statecharts with Run-to-Completion Semantics}
\paperauthor{K. Morris, C. Snook, T.S.Hoang, R. Armstrong, and M. Butler}
\usepackage{chgtrk}
\newCTcontributor{Karla}
\newCTcontributor{Colin}
\newCTcontributor{Rob}
\newCTcontributor{Son}
\newCTcontributor{Michael}

\begin{document}

%%%%% Reviewer 1 (Begin) %%%%%
% Overall evaluation: 1 (weak accept)

% ----------- Overall evaluation -----------
% The paper deals with an evergreen topic of verifying state-based
% models, namely statecharts. The authors extended the well-know
% Event-B toolset to be able to support the 'run-to-completion'
% semantics of modern statechart languages. Besides the theoretical
% results, the authors also provide the algorithms in the tool. The
% paper also contains the necessary amount of figures and examples.
% The related work is also comprehensive enough, it proves that the
% authors are familiar with the literature.

\begin{comment}{Reviewer \#1}
Contribution:
Authors present an encoding scheme to be able to handle the
abstraction (and refinement) of statechart models. The contribution is
mainly focused onto the special encoding and the implementation. The
contribution is enough for a workshop paper and it could be a nice
piece of work to be shown in the workshop.
However, the approach seems not to scale well, so I would suggest the
authors evaluate their work using more complex (industrial)
verification problems.
\end{comment}

\begin{response}
  As discussed in the paper we believe it will scale well provided certain unusual styles of modelling are avoided. 
  However, evaluation on larger models is definitely worthwhile.
  The following is added to conclusions.
  \begin{quote}
    ``We will also demonstrate the scalability of the translation on
    more realistic industrial examples. The Haemodialysis Machine case
    study(cite) from the ABZ 2016 conference would make a good test
    case since its highly sequential processes are natural for a
    state-chart representation and results can be compared with
    existing iUML-B solutions(cite). The ERTMS Hybrid Level 3 case
    study(cite) from the ABZ 2018 conference is also an industrial
    example which would test the method. This case study would require
    lifting of the output models to a generalised set of instances
    using a model composition technique that we have been developing
    for this purpose.''
  \end{quote}
\end{response}

% Writing: The paper is easy to read, easy to follow. Except for minor
% typos, it has good quality.

% My overall opinion is that I suggest this paper be presented at the
% workshop.

\begin{comment}{Reviewer \#1}
  Typos and suggestions:

  an intermediate refinement level by translation into Event-B --> an
  intermediate refinement level by A translation into Event-B

  Trigger events are queued when they are raised and then one is
  dequeued --> Trigger events are queued when they are raised, and
  then one is dequeued

  This is repeated until no transitions are enabled and then the next
  trigger --> This is repeated until no transitions are enabled, and
  then the next trigger

  The ASIC starts by initialising the buzzer, this involves sending
  --> The ASIC starts by initialising the buzzer; this involves
  sending

  In practice we wish to leverage --> In practice, we wish to leverage
  for the messages send between the system components --> for the
  messages sent between the system components

  right hand region --> right-hand region
\end{comment}
\begin{response}
  Done. Thank you very much.
\end{response}
%%%%% Reviewer 1 (End) %%%%%

%%%%% Reviewer 2 (Begin) %%%%%
% Overall evaluation: -1 (weak reject)

% ----------- Overall evaluation -----------
% Overview:
% =========
% The paper describes an approach to represent Statecharts semantics
% in iUML-B, a diagrammatic notation for Event-B.  The focus in this
% work is supporting hierarchical refinement, that is, describing
% nested behavior on a previously "leaf-level" state.   The
% Statecharts semantics represented are similar to UML Statecharts.

% Section 2 describes background.  Section 2.1 briefly describes the
% run-to-completion semantics of SCXML (StateCharts XML); Section 2.2
% describes Event B, focusing on refinement, and Section 2.3 describes
% iUML-B State machines, which have a direct translation into Event B
% specifications.  Although the iUML-B state machines look much like
% Statecharts, they do not share the run-to-completion or transition
% triggering semantics.

% Section 3 describes an example model of an intrusion detection
% system initialization sequence.  The model is constructed first as a
% sequential state machine that describes the initialization phases,
% then is refined twice: the first refinement introduces the
% communication SPI bus, and  second is a hierarchical refinement that
% describes in more detail the behavior of each initialization phase.
% Throughout the refinements, we would like to preserve an invariant
% that the initialization phase is in 'go' only if the SPI bus is
% idle.

% Section 4 describes refinements for this notion of StateCharts and
% their relation to Event-B.  The goal is to have a notion of proof
% that is preserved  by hierarchical refinement: we can strengthen
% transition firing conditions, add nested statecharts, and allowing
% additional triggers for internal actions (which are viewed as
% non-deterministic in child context where they may fire).  It
% provides illustrations of how the interplay between micro/macrosteps
% leads to difficulties in terms of Event-B refinement: a strengthened
% transition guard may lead to a system in which fewer microsteps are
% required, weakening the guard on new macrosteps.  To prevent such
% weakenings, the system uses a non-deterministic semantics, in which
% enabled transitions may fire, but do not need to fire, and it is
% always possible that no transitions fire.  An event is generated for
% each possible combination of transitions that may occur.

% In order to support this translation, the SCXML definition is
% extended to support refinement, invariant, and guard (to allow
% refinement of transition labels at lower levels of abstraction).

% Section 5 describes the translation in more detail. This explanation
% is at the level of a prose description, other than for the pieces of
% the translation related to triggering events.  I suspect that these
% aspects have been dealt with in previous papers, but in this case
% the authors should have provided citations to the work containing
% the definitions.  While it is possible to get an outline of the
% translation scheme, it is difficult to understand it in full
% generality.

% Section 6 describes proofs of the intrusion detection system using
% Rodin (the Event-B prover).  In order to prove the property under
% future refinements, one must add a series of invariants to states
% that limit the behavior of future refinements.  In the case of this
% model, a handful of such invariants are required.

% Section 7 concludes.


% Review:
% =======
% The paper is well written and describes interesting work towards
% creating a Statecharts semantics that both supports
% run-to-completion semantics and hierarchical refinement.  For the
% most part, the writing is clear and easy to understand.

\begin{comment}{Reviewer \#2}
  Nevertheless, there are some significant problems with
  the work from my perspective, starting from motivation. There have
  been many, many StateCharts semantics proposed over 20 years and any
  proposal for new semantics much have a clear reason for existing.
  The current approach, while having novelty in that it both supports
  hierarchical refinement and run-to-completion behavior, needs a
  stronger motivation in terms of solving design challenges faced by
  real engineers.
\end{comment}

\begin{response}
The following text is added to the 2nd last paragraph on page 2.
\begin{quote}
  ``The motivation of the work is entirely driven by the industrial partner, who feels that the current sematics for Statecharts is insufficient for formal verification.''
\end{quote}
\end{response}

\begin{comment}{Reviewer \#2}
  The current semantics is one of non-determinism as to which events
  will fire in a given microstep.  While this allows refinement, it
  does not admit a deterministic execution strategy, which means that
  it is not currently useful for generation of implementations.  In
  addition, it appears that it is possible that events can be "lost"
  and the system may choose not to execute them.  The authors must
  provide additional justification that this is a sensible semantics;
  I suspect that it will be surprising to most users who are familiar
  with StateCharts.  
 \end{comment}
  
  \begin{response}
    The non-determinism is removed in refinements before implementation. Abstraction often entails non-determinism.
    I.e., the possibility of losing an event is resolved one way or the other when we reach a decision on whether it should be fired or not.
    The following is added ``The non-determinism is useful to allow abstractions which facilitate verification proofs but must be removed in refinements to reach a design suitable for implementation.''
  \end{response}

\begin{comment}{Reviewer \#2}  
  When adding transitions at lower layers, it was
  not clear to me how these new transitions fit into the cross-product
  translation used to determine which set of transitions would fire.
  Perhaps this is handled layer-by-layer, but then each layer would
  need a scheduler and this was not discussed.   
\end{comment}

\begin{response}
	Yes each layer makes a new cross product. 
	The following is added ``Each refinement produces a new set of events representing the (possibly extended) transition combinations that may occur at that level of refinement.''
	(We already explain in the sentence before that these events replace the scheduler).
\end{response}

\begin{comment}{Reviewer \#2}
  The goal appears to be to try to create something that resembles
  StateCharts but is bound to the semantics of Event-B.  In this case,
  the authors should also justify why Event-B is a suitable language
  for representing Statecharts behavior.  In this case, it appeared
  that the target language made some aspects of behavior difficult to
  formalize.  
\end{comment}

\begin{response}
  We have added to the introduction section a couple of sentence regarding the advantages of using 
  the Event-B within the Rodin tool.
  ``The Event-B modelling method provides the logic and refinement theory required to formally analyse a system model.  The open-source Rodin provides support for Event-B including automatic theorem provers and model checking capabilities. iUML-B augments the Event-B language with a graphical interface including state-machines.''
\end{response}

\begin{comment}{Reviewer \#2}
  In addition, I would have liked a more formal description of the
  translation, or at least a reference to a more formal description of
  the translation than the prose description of different model
  aspects.  
\end{comment}

\begin{response}
  We feel that the current description of the translation is at the right level for understanding, supported by the running example. More formal/technical descriptions would be otherwise disruptive to the flow of the paper.
\end{response}

%%%%% Reviewer 2 (End) %%%%%

%%%%% Reviewer 3 (Begin) %%%%%

% Overall evaluation: 0 (borderline paper)

% ----------- Overall evaluation -----------
% This is an interesting subject and approach. The presentation is not
% that convincing though, it is slightly hard to follow the details.

\begin{comment}{Reviewer \#3}
  Page 1:

  * Line -2, it says:

  "While functional properties (usually) can be tested, safety,
  security and reliability properties
  (usually) must be proved formally."

  "Can" ... and ... "must" ... why?
\end{comment}

\begin{response}
  We have revised the sentence. ``While functional properties (usually) can be tested, the need for instantiation and state space explosion can make testing of safety, security and reliability properties intractable. Therefore, such properties must be proved formally.''
\end{response}

\begin{comment}{Reviewer \#3}
  Page 2:

  * Top: The first paragraph can be expressed more clearly. That is:
  what is the approach taken? Is UML state charts mapped to iUML-B or
  not?
\end{comment}

\begin{response}
  The following is added ``The binding is facilitated by translating to iUML-B, a diagrammatic modelling notation for Event-B.''
\end{response}

\begin{comment}{Reviewer \#3}
  Page 2:
  
  * Second paragraph appears complicated writing.
\end{comment}

\begin{response}
  We feel it is well written and understandable and do not understand why the reviewer thinks it is complicated writing. Perhaps the changes made in other areas of the introduction help the reviewer.
\end{response}

\begin{comment}{Reviewer \#3}
  Page 3:

* Listing 1: I think I would name that variable "run2completion" differently.
\end{comment}

\begin{response}
	Changed ``run2completion'' to ``completion''.
\end{response}


\begin{comment}{Reviewer \#3}
  Page 4:

  * Mid, it is not clear what this means:

  "The diagrammatic models are contained within an Event-B machine"
\end{comment}

\begin{response}
	Agree - the containment is an unnecessary technical detail. Changed ``are contained within'' to ``relate to''.
\end{response}

\begin{comment}{Reviewer \#3}
Page 4:
  and this as well:

 "while Event-B events are expected to already exist to represent the transitions."
\end{comment}

\begin{response}
	Agree - this is an unnecessary technical detail. Deleted  ``while Event-B events are expected to already exist to represent the transitions''.
\end{response}

\begin{comment}{Reviewer \#3}
  Page 5:

  * It would seem more natural to have one state variable ranging over
  an enumerated type of states, rather than having a Boolean flag for
  each state.
\end{comment}
  
  \begin{response}
    In the interest of clarity we have added the following text: ``iUML-B also provides the option of an alternative translation with a single state variable ranging over an enumerated type of states, however, the boolean representation of each state is more natural for a user to reference in SCXML guards and actions.''
  \end{response}
  
\begin{comment}{Reviewer \#3}

  * Section 3: be more clear about what this system does. Is it just a
  buzz that goes off when a sensor senses something?
\end{comment}

\begin{response}
        The case study is about an enabling mechanism for a security system which is confidential and we feel that full details of the system will not bring any extra points to our contribution.
\end{response}

\begin{comment}{Reviewer \#3}

  * Mid:

  "At this abstraction the spi_done triggered, which ..."
  ->
  " At this abstraction there is only one event, spi_done, which ..."
\end{comment}

\begin{response}
  The text has been changed to: ``At this abstraction the spi\_done trigger, which indicates that the SPI system has finished, is an internal trigger that can be fired at any time.''
\end{response}

\begin{comment}{Reviewer \#3}
  * Line -9: "on an Idle state" -> "in an Idle state".
\end{comment}

\begin{response}
  Fixed, thank you very much.
\end{response}

\begin{comment}{Reviewer \#3}
* Line -6: "while SPI subsystem ..." -> "while the SPI subsystem ..."
\end{comment}

\begin{response}
  Fixed, thank you very much.
\end{response}

\begin{comment}{Reviewer \#3}
  Page 6:

  * Figure 2: this looks like a way of modeling event refinement,
  which seems different from state refinement. Perhaps comment on
  this.
\end{comment}

\begin{response}
  To improve clarity we have revised the text to clearly state that 
  the refinement used is superposition. ``In a subsequent level of refinement, shown in Fig. 2b, the designer uses superposition refinement to add a parallel state representing the SPI subsystem.''
\end{response}

\begin{comment}{Reviewer \#3}
  * Line -7: "This safety property is introduced ..." : where, when?
\end{comment}

\begin{response}
	Agree - Here we are talking about the problem not the model. Changed to ``This safety property should hold at the first refinement and be preserved in all future refinements''
\end{response}

\begin{comment}{Reviewer \#3}
* Figure 2(b): "last_byte_send" -> "last_byte_sent".
\end{comment}

\begin{response}
  Agree - We have modified the figure.
\end{response}

\begin{comment}{Reviewer \#3}
  Page 7:

  * Mid: "Ancillary data, with corresponding actions to alter it, can
  ..." - something is wrong with this sentence.
\end{comment}

\begin{response}
  We have revised the sentence to: ``Actions that modify ancillary data can be added to transitions.''
\end{response}

\begin{comment}{Reviewer \#3}
* Line -4: I don't understand: "Note that external triggers are always unguarded ...".
\end{comment}

\begin{response}
  We have revised the sentence for clarification. Changed to ``External triggers represent inputs to the model. If no restrictions are imposed on the inputs then the events that raise external trigger are always unguarded and cannot be refined.''
\end{response}

\begin{comment}{Reviewer \#3}
  Page 8:

* The next couple of pages is a lot of English without some structure to hang it up on.
\end{comment}

\begin{response}
  The section is an in-depth discussion about the reasoning behind the translation and we would prefer not to introduce gratuitous (sub-)headings.
\end{response}

\begin{comment}{Reviewer \#3}
  Page 9:

* The three bullets (refinement, invariant, guard): there is mention of the parent state. Not sure I understand.
\end{comment}

\begin{response}
	By parent we mean the element that owns (or contains) the element that is being discussed. This is a very common analogy.
\end{response}

\begin{comment}{Reviewer \#3}
  Page 10:

* In general, the explanation of the example could be improved a lot.

  Page 12:

* I had a hard time reading this.
\end{comment}

\begin{response}
  Without more specific details we are not sure what needs improving in these sections. Other reviewers commented that  the paper is easy to follow so we have not changed anything in response to these comments.
\end{response}

\begin{comment}{Reviewer \#3}
  Page 14:

* Mid: "SCXML future..TransitionSet" - is this correct?
\end{comment}
%%%%% Reviewer 3 (End) %%%%%

\begin{response}
	It was intended as shorthand for the three events: 'SCXML\_futureUntriggeredTransitionSet', 'SCXML\_futureInternalTransitionSet', 'SCXML\_futureExternalTransitionSet' but we have now listed them explicitly.
\end{response}

\end{document}
