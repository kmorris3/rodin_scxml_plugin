machine scxml_m0_scxml 
sees scxml_c0_abstract

variables
	iq
	eq
	dt
	uc

invariants
	@iq: iq ∈ ℙ(AbstractInternalTriggers)
	@eq: eq ∈ ℙ(AbstractExternalTriggers)
	@dt: dt ∈ DeQueueType
	@dtwd: dt ⊆ AbstractInternalTriggers ∪ AbstractExternalTriggers
	@uc: uc ∈ BOOL
	
events

	event INITIALISATION
	then
		@iq_init:	iq ≔ ∅ 
		@eq_init: 	eq ≔ ∅
		@dt_init:	dt ≔ ∅
		@uc_init: 	uc ≔ FALSE
	end
	
	event raiseExternalTrigger
	any t where
		@t:			t ∈ AbstractExternalTriggers
	then
		@eq_set:		eq ≔ eq ∪ {t}
	end
	
	event dequeueExternal
	any t new_eq where 
		@t: 			t ∈ eq
		@new_eq:		new_eq = eq ∖ {t}
		@dt:			dt = ∅
		@uc:			uc = TRUE
		@iq:			iq = ∅
	then 
		@dt_set: 	dt ≔ {t}
		@eq_set:		eq ≔ new_eq 
		@uc_set:		uc ≔ FALSE
	end
	
	event dequeueInternal
	any t new_eq where 
		@t: 			t ∈ iq
		@new_eq:		new_eq = eq ∖ {t}
		@dt:			dt = ∅
		@uc:			uc = TRUE 
	then 
		@dt_set: 	dt ≔ {t}
		@eq_set:		eq ≔ new_eq 
		@uc_set:		uc ≔ FALSE
	end
	
	event triggeredTransition 
	any t R
	where 
		@t: 			t ∈ dt
		theorem @uc:		uc = FALSE	//sanity check
		@R:			R ⊆ AbstractInternalTriggers
	then 
		@dt_set: 	dt ≔ ∅
		@iq_set:		iq ≔ iq ∪ R		//raised triggers
	end
	
	event completeTriggered
		any t where 
		@t: 			t ∈ dt
		@uc:			uc = FALSE			//do we need this? 
	then 
		@dt_set: 	dt ≔ ∅
	end
	
	event untriggeredTransition
	any R
	where 
		@dt: 		dt = ∅
		@uc:			uc = FALSE		
		@R:			R ⊆ AbstractInternalTriggers
	then 
		@iq_set:		iq ≔ iq ∪ R		//raised triggers
	end
	
	event completeUntriggered
	where
		@dt: 		dt = ∅
		@uc:			uc = FALSE
	then
		@uc_set:		uc ≔ TRUE
	end
	
end

